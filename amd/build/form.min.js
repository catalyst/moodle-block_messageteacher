define("block_messageteacher/form",["core/fragment","core/ajax","core/modal_factory","core/modal_events","core/str"],(function(Fragment,Ajax,ModalFactory,ModalEvents,Str){var t={modal:null,responseModal:null,contextid:null,appendurl:!1,init:async function(){const title=await Str.get_string("pluginname","block_messageteacher"),send=await Str.get_string("send","block_messageteacher");t.responseModal=await ModalFactory.create({type:ModalFactory.types.DEFAULT,title:title}),t.modal=await ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:title}),t.modal.setLarge(),t.modal.setSaveButtonText(send),t.modal.getRoot().on(ModalEvents.hidden,function(){t.modal.setBody("")}.bind(this)),t.modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),t.modal.getRoot().find("form").submit()})),t.modal.getRoot().on("submit","form",t.submitForm);for(var links=document.querySelectorAll(".messageteacher_link"),i=0;i<links.length;i++)null===t.contextid&&(t.contextid=links[i].parentElement.parentElement.dataset.contextid,t.appendurl=links[i].parentElement.parentElement.dataset.appendurl),links[i].addEventListener("click",t.showForm)},getForm:function(params){return Fragment.loadFragment("block_messageteacher","message_form",t.contextid,params)},showForm:function(e){e.preventDefault(),t.modal.show(),t.modal.setBody(t.getForm(e.currentTarget.dataset))},submitForm:async function(e){e.preventDefault();var recipientid=t.modal.getRoot().find("[name=recipientid]").val(),message=t.modal.getRoot().find("[name=message]").val();t.appendurl&&(message+="\n\n"+t.modal.getRoot().find("[name=referurl]").val()),M.util.js_pending("block_messageteacher_send");try{const response=await Ajax.call([{methodname:"core_message_send_instant_messages",args:{messages:[{touserid:recipientid,text:message}]}}])[0];if(t.modal.hide(),-1===response.msgid)t.responseModal.setBody(response.errormessage);else{const sent=await Str.get_string("messagesent","block_messageteacher");t.responseModal.setBody(sent)}t.responseModal.show(),M.util.js_complete("block_messageteacher_send")}catch(ex){t.modal.hide(),t.responseModal.setBody(ex.message),t.responseModal.show(),M.util.js_complete("block_messageteacher_send")}}};return t}));

//# sourceMappingURL=form.min.js.map